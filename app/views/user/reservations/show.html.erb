<div class="container mx-auto p-6">
    <div class="reservation-details">
        <h1 class="text-xl font-semibold">Reservation Details</h1>

        <div class="mb-4">
            <%= label_tag :room_id, "Room" %>
            <p><%= @reservation.room.name %></p>
        </div>

        <div class="mb-4">
            <%= label_tag :date, "Reservation Date" %>
            <p><%= @reservation.date.strftime("%B %d, %Y") %></p>
        </div>

        <div class="mb-4 flex space-x-4">
            <div class="w-1/2">
                <%= label_tag :start_time, "Start Time" %>
                <p><%= @reservation.start_time.strftime("%I:%M %p") %></p>
            </div>

            <div class="w-1/2">
                <%= label_tag :end_time, "End Time" %>
                <p><%= @reservation.end_time.strftime("%I:%M %p") %></p>
            </div>
        </div>

        <div class="mb-4">
            <%= label_tag :reservation_members, "Members" %>
            <ul>
                <li><%= @reservation.user.email %></li>
            </ul>
            <ul>
                <% @reservation.members.each do |user| %>
                    <li><%= user.email %></li>
                <% end %>
            </ul>
        </div>

        <div class="flex space-x-2">
            <%= link_to "Back", reservations_path, class: "bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded-lg" %>
            <%= link_to "Edit", edit_reservation_path(@reservation), class: "bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg" %>
            <% if @reservation.pending? %>
                <% reservation_datetime = @reservation.date.to_time.change({ hour: @reservation.start_time.hour, min: @reservation.start_time.min }) %>
                <% reservation_datetime = reservation_datetime.in_time_zone('Asia/Bangkok') %>
                <% time_window_start = reservation_datetime - 15.minutes %>
                <% time_window_end = reservation_datetime + 15.minutes %>

                <% current_time_in_bkk = Time.current.in_time_zone('Asia/Bangkok') %>

                <% if current_time_in_bkk.between?(time_window_start, time_window_end) %>
                    <%= link_to "Check-In", new_reservation_check_in_path(@reservation), class: "bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg" %>
                <% else %>
                    <%= link_to "Check-In", "#", class: "bg-gray-400 text-gray-600 px-4 py-2 rounded-lg cursor-not-allowed", title: "Check-In available 15 minutes before or after the start time" %>
                <% end %>

            <% else %>
                <span class="bg-gray-400 text-gray-600 px-4 py-2 rounded-lg cursor-not-allowed">Check-In</span>
            <% end %>
        </div>
    </div>
</div>